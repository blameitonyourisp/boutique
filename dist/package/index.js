class e{constructor(e){this.evs={},this.state=e}createRedaction(e){return t=>{const{state:s,tracer:r}=this.proxy;this.redact(r,e(s,t))}}createListener(e){const{state:t,tracer:s}=this.proxy;return e(t),{func:s=>e(t,s)(),deps:s.map((e=>e.key))}}addListener(e){e.deps.forEach((t=>{this.evs[t]=[...this.evs[t]||[],e]}))}removeListener(e){e.deps.forEach((t=>{this.evs[t]=this.evs[t].filter((t=>t!==e))}))}redact(e,t,s=[]){e.forEach((e=>{if(e.value){let t=this.state;e.key.split(".").slice(1).reduce(((r,n,c,o)=>(c!==o.length-1?t=t[n]||{}:t[n]=e.value,r=`${r}.${n}`,s.push(...this.evs[r]||[]),r)),"")}})),[...new Set(s)].forEach((e=>e.func(t)))}handler(e,t=""){return{get:(s,r)=>{const n=`${t}.${r}`;t&&n.includes(e[0].key)?e.splice(0,1,{key:n}):e.unshift({key:n});const c=s[r];return"object"!=typeof c?c:new Proxy(c,this.handler(e,n))},set:(s,r,n)=>!!e.push({key:`${t}.${r}`,value:n})}}get proxy(){const e=[];return{state:new Proxy(this.state,this.handler(e)),tracer:e}}}const t=e=>{if(e instanceof Array)return s(e);const r={};for(const s in e)"object"==typeof e[s]?r[s]=t(e[s]):r[s]=e[s];return r},s=e=>{const s=[];return e.forEach((e=>{"object"==typeof e?s.push(t(e)):s.push(e)})),s};export{e as Boutique,t as proxyToObject};
